(function(){var J;if(typeof(module)!=="undefined"&&typeof(module.exports)!=="undefined"){J=module.exports}else{J={};if(!this.Tautologistics){this.Tautologistics={}}if(this.Tautologistics.NodeHtmlParser){return}this.Tautologistics.NodeHtmlParser=J}function h(N,M){var O=function(){};O.prototype=M.prototype;N.super_=M;N.prototype=new O();N.prototype.constructor=N}var c={Text:"text",Tag:"tag",Attr:"attr",CData:"cdata",Comment:"comment"};function e(N,O){this._options=O?O:{};this._validateBuilder(N);var M=this;this._builder=N;this.reset()}e.prototype.reset=function E(){this._state={mode:c.Text,pos:0,data:null,pendingText:null,pendingWrite:null,lastTag:null,isScript:false,needData:false,output:[],done:false};this._builder.reset()};e.prototype.parseChunk=function z(M){this._state.needData=false;this._state.data=(this._state.data!==null)?this._state.data.substr(this.pos)+M:M;while(this._state.pos<this._state.data.length&&!this._state.needData){this._parse(this._state)}};e.prototype.parseComplete=function a(M){this.reset();this.parseChunk(M);this.done()};e.prototype.done=function g(){this._state.done=true;this._parse(this._state);this._flushWrite();this._builder.done()};e.prototype._validateBuilder=function x(M){if((typeof M)!="object"){throw new Error("Builder is not an object")}if((typeof M.reset)!="function"){throw new Error("Builder method 'reset' is invalid")}if((typeof M.done)!="function"){throw new Error("Builder method 'done' is invalid")}if((typeof M.write)!="function"){throw new Error("Builder method 'write' is invalid")}if((typeof M.error)!="function"){throw new Error("Builder method 'error' is invalid")}};e.prototype._parse=function u(){switch(this._state.mode){case c.Text:return this._parseText(this._state);case c.Tag:return this._parseTag(this._state);case c.Attr:return this._parseAttr(this._state);case c.CData:return this._parseCData(this._state);case c.Comment:return this._parseComment(this._state)}};e.prototype._writePending=function v(M){if(!this._state.pendingWrite){this._state.pendingWrite=[]}this._state.pendingWrite.push(M)};e.prototype._flushWrite=function d(){if(this._state.pendingWrite){for(var N=0,M=this._state.pendingWrite.length;N<M;N++){var O=this._state.pendingWrite[N];this._builder.write(O)}this._state.pendingWrite=null}};e.prototype._write=function n(M){this._flushWrite();this._builder.write(M)};e._re_parseText_scriptClose=/<\s*\/\s*script/ig;e.prototype._parseText=function p(){var M=this._state;var O;if(M.isScript){e._re_parseText_scriptClose.lastIndex=M.pos;O=e._re_parseText_scriptClose.exec(M.data);O=(O)?O.index:-1}else{O=M.data.indexOf("<",M.pos)}var N=(O===-1)?M.data.substring(M.pos,M.data.length):M.data.substring(M.pos,O);if(O<0&&M.done){O=M.data.length}if(O<0){if(M.isScript){M.needData=true;return}if(!M.pendingText){M.pendingText=[]}M.pendingText.push(M.data.substring(M.pos,M.data.length));M.pos=M.data.length}else{if(M.pendingText){M.pendingText.push(M.data.substring(M.pos,O));N=M.pendingText.join("");M.pendingText=null}else{N=M.data.substring(M.pos,O)}if(N!==""){this._write({type:c.Text,data:N})}M.pos=O+1;M.mode=c.Tag}};e.re_parseTag=/\s*(\/?)\s*([^\s>\/]+)(\s*)\??(>?)/g;e.prototype._parseTag=function w(){var P=this._state;e.re_parseTag.lastIndex=P.pos;var O=e.re_parseTag.exec(P.data);if(O){if(!O[1]&&O[2].substr(0,3)==="!--"){P.mode=c.Comment;P.pos+=3;return}if(!O[1]&&O[2].substr(0,8)==="![CDATA["){P.mode=c.CData;P.pos+=8;return}if(!P.done&&(P.pos+O[0].length)===P.data.length){P.needData=true;return}var N;if(O[4]===">"){P.mode=c.Text;N=O[0].substr(0,O[0].length-1)}else{P.mode=c.Attr;N=O[0]}P.pos+=O[0].length;var M={type:c.Tag,name:O[1]+O[2],raw:N};if(P.mode===c.Attr){P.lastTag=M}if(M.name.toLowerCase()==="script"){P.isScript=true}else{if(M.name.toLowerCase()==="/script"){P.isScript=false}}if(P.mode===c.Attr){this._writePending(M)}else{this._write(M)}}else{P.needData=true}};e.re_parseAttr_findName=/\s*([^=<>\s'"\/]+)\s*/g;e.prototype._parseAttr_findName=function B(){e.re_parseAttr_findName.lastIndex=this._state.pos;var M=e.re_parseAttr_findName.exec(this._state.data);if(!M){return null}if(this._state.pos+M[0].length!==e.re_parseAttr_findName.lastIndex){return null}return{match:M[0],name:M[1]}};e.re_parseAttr_findValue=/\s*=\s*(?:'([^']*)'|"([^"]*)"|([^'"\s\/>]+))\s*/g;e.re_parseAttr_findValue_last=/\s*=\s*['"]?(.*)$/g;e.prototype._parseAttr_findValue=function i(){var N=this._state;e.re_parseAttr_findValue.lastIndex=N.pos;var M=e.re_parseAttr_findValue.exec(N.data);if(!M){if(!N.done){return null}e.re_parseAttr_findValue_last.lastIndex=N.pos;M=e.re_parseAttr_findValue_last.exec(N.data);if(!M){return null}return{match:M[0],value:(M[1]!=="")?M[1]:null}}if(N.pos+M[0].length!==e.re_parseAttr_findValue.lastIndex){return null}return{match:M[0],value:M[1]||M[2]||M[3]}};e.re_parseAttr_splitValue=/\s*=\s*['"]?/g;e.re_parseAttr_selfClose=/(\s*\/\s*)(>?)/g;e.prototype._parseAttr=function b(){var O=this._state;var M=this._parseAttr_findName(O);if(!M||M.name==="?"){e.re_parseAttr_selfClose.lastIndex=O.pos;var P=e.re_parseAttr_selfClose.exec(O.data);if(P&&P.index===O.pos){if(!O.done&&!P[2]&&O.pos+P[0].length===O.data.length){O.needData=true;return}O.lastTag.raw+=P[1];this._write({type:c.Tag,name:"/"+O.lastTag.name,raw:null});O.pos+=P[1].length}var Q=O.data.indexOf(">",O.pos);if(Q<0){if(O.done){O.lastTag.raw+=O.data.substr(O.pos);O.pos=O.data.length;return}O.needData=true}else{O.pos=Q+1;O.mode=c.Text}return}if(!O.done&&O.pos+M.match.length===O.data.length){O.needData=true;return null}O.pos+=M.match.length;var N=this._parseAttr_findValue(O);if(N){if(!O.done&&O.pos+N.match.length===O.data.length){O.needData=true;O.pos-=M.match.length;return}O.pos+=N.match.length}else{e.re_parseAttr_splitValue.lastIndex=O.pos;if(e.re_parseAttr_splitValue.exec(O.data)){O.needData=true;O.pos-=M.match.length;return}N={match:"",value:null}}O.lastTag.raw+=M.match+N.match;this._writePending({type:c.Attr,name:M.name,data:N.value})};e.re_parseCData_findEnding=/\]{1,2}$/;e.prototype._parseCData=function o(){var N=this._state;var P=N.data.indexOf("]]>",N.pos);if(P<0&&N.done){P=N.data.length}if(P<0){e.re_parseCData_findEnding.lastIndex=N.pos;var M=e.re_parseCData_findEnding.exec(N.data);if(M){N.needData=true;return}if(!N.pendingText){N.pendingText=[]}N.pendingText.push(N.data.substr(N.pos,N.data.length));N.pos=N.data.length;N.needData=true}else{var O;if(N.pendingText){N.pendingText.push(N.data.substring(N.pos,P));O=N.pendingText.join("");N.pendingText=null}else{O=N.data.substring(N.pos,P)}this._write({type:c.CData,data:O});N.mode=c.Text;N.pos=P+3}};e.re_parseComment_findEnding=/\-{1,2}$/;e.prototype._parseComment=function j(){var M=this._state;var P=M.data.indexOf("-->",M.pos);if(P<0&&M.done){P=M.data.length}if(P<0){e.re_parseComment_findEnding.lastIndex=M.pos;var O=e.re_parseComment_findEnding.exec(M.data);if(O){M.needData=true;return}if(!M.pendingText){M.pendingText=[]}M.pendingText.push(M.data.substr(M.pos,M.data.length));M.pos=M.data.length;M.needData=true}else{var N;if(M.pendingText){M.pendingText.push(M.data.substring(M.pos,P));N=M.pendingText.join("");M.pendingText=null}else{N=M.data.substring(M.pos,P)}this._write({type:c.Comment,data:N});M.mode=c.Text;M.pos=P+3}};function I(N,M){this.reset();this._options=M?M:{};if(this._options.ignoreWhitespace===undefined){this._options.ignoreWhitespace=false}if(this._options.includeLocation===undefined){this._options.includeLocation=false}if(this._options.verbose===undefined){this._options.verbose=true}if(this._options.enforceEmptyTags===undefined){this._options.enforceEmptyTags=true}if(this._options.caseSensitiveTags===undefined){this._options.caseSensitiveTags=false}if(this._options.caseSensitiveAttr===undefined){this._options.caseSensitiveAttr=false}if((typeof N)=="function"){this._callback=N}}I._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1,"?xml":1};I.reWhitespace=/^\s*$/;I.prototype.dom=null;I.prototype.reset=function q(){this.dom=[];this._done=false;this._tagStack=[];this._lastTag=null;this._tagStack.last=function M(){return(this.length?this[this.length-1]:null)};this._line=1;this._col=1};I.prototype.done=function f(){this._done=true;this.handleCallback(null)};I.prototype.error=function k(M){this.handleCallback(M)};I.prototype.handleCallback=function A(M){if((typeof this._callback)!="function"){if(M){throw M}else{return}}this._callback(M,this.dom)};I.prototype.isEmptyTag=function t(N){var M=N.name.toLowerCase();if(M.charAt(0)=="?"){return true}if(M.charAt(0)=="/"){M=M.substring(1)}return this._options.enforceEmptyTags&&!!I._emptyTags[M]};I.prototype._getLocation=function G(){return{line:this._line,col:this._col}};I.prototype._updateLocation=function L(O){var N=(O.type===c.Tag)?O.raw:O.data;if(N===null){return}var M=N.split("\n");this._line+=M.length-1;if(M.length>1){this._col=1}this._col+=M[M.length-1].length;if(O.type===c.Tag){this._col+=2}else{if(O.type===c.Comment){this._col+=7}else{if(O.type===c.CData){this._col+=12}}}};I.prototype._copyElement=function l(M){var N={type:M.type};if(this._options.verbose&&M.raw!==undefined){N.raw=M.raw}if(M.name!==undefined){switch(M.type){case c.Tag:N.name=this._options.caseSensitiveTags?M.name:M.name.toLowerCase();break;case c.Attr:N.name=this._options.caseSensitiveAttr?M.name:M.name.toLowerCase();break;default:N.name=this._options.caseSensitiveTags?M.name:M.name.toLowerCase();break}}if(M.data!==undefined){N.data=M.data}if(M.location){N.location={line:M.location.line,col:M.location.col}}return N};I.prototype.write=function H(M){if(this._done){this.handleCallback(new Error("Writing to the builder after done() called is not allowed without a reset()"))}if(this._options.includeLocation){if(M.type!==c.Attr){M.location=this._getLocation();this._updateLocation(M)}}if(M.type===c.Text&&this._options.ignoreWhitespace){if(I.reWhitespace.test(M.data)){return}}var O;var P;if(!this._tagStack.last()){if(M.type===c.Tag){if(M.name.charAt(0)!="/"){P=this._copyElement(M);this.dom.push(P);if(!this.isEmptyTag(P)){this._tagStack.push(P)}this._lastTag=P}}else{if(M.type===c.Attr&&this._lastTag){if(!this._lastTag.attributes){this._lastTag.attributes={}}this._lastTag.attributes[this._options.caseSensitiveAttr?M.name:M.name.toLowerCase()]=M.data}else{this.dom.push(this._copyElement(M))}}}else{if(M.type===c.Tag){if(M.name.charAt(0)=="/"){var N=this._options.caseSensitiveTags?M.name.substring(1):M.name.substring(1).toLowerCase();if(!this.isEmptyTag(M)){var Q=this._tagStack.length-1;while(Q>-1&&this._tagStack[Q--].name!=N){}if(Q>-1||this._tagStack[0].name==N){while(Q<this._tagStack.length-1){this._tagStack.pop()}}}}else{O=this._tagStack.last();if(M.type===c.Attr){if(!O.attributes){O.attributes={}}O.attributes[this._options.caseSensitiveAttr?M.name:M.name.toLowerCase()]=M.data}else{P=this._copyElement(M);if(!O.children){O.children=[]}O.children.push(P);if(!this.isEmptyTag(P)){this._tagStack.push(P)}if(M.type===c.Tag){this._lastTag=P}}}}else{O=this._tagStack.last();if(M.type===c.Attr){if(!O.attributes){O.attributes={}}O.attributes[this._options.caseSensitiveAttr?M.name:M.name.toLowerCase()]=M.data}else{if(!O.children){O.children=[]}O.children.push(this._copyElement(M))}}}};I.prototype._options=null;I.prototype._callback=null;I.prototype._done=false;I.prototype._tagStack=null;function s(M){s.super_.call(this,M,{ignoreWhitespace:true,verbose:false,enforceEmptyTags:false,caseSensitiveTags:true})}h(s,I);s.prototype.done=function r(){var O={};var P;var N=C.getElementsByTagName(function(Q){return(Q=="rss"||Q=="feed")},this.dom,false);if(N.length){P=N[0]}if(P){if(P.name=="rss"){O.type="rss";P=P.children[0];O.id="";try{O.title=C.getElementsByTagName("title",P.children,false)[0].children[0].data}catch(M){}try{O.link=C.getElementsByTagName("link",P.children,false)[0].children[0].data}catch(M){}try{O.description=C.getElementsByTagName("description",P.children,false)[0].children[0].data}catch(M){}try{O.updated=new Date(C.getElementsByTagName("lastBuildDate",P.children,false)[0].children[0].data)}catch(M){}try{O.author=C.getElementsByTagName("managingEditor",P.children,false)[0].children[0].data}catch(M){}O.items=[];C.getElementsByTagName("item",P.children).forEach(function(T,Q,U){var S={};try{S.id=C.getElementsByTagName("guid",T.children,false)[0].children[0].data}catch(R){}try{S.title=C.getElementsByTagName("title",T.children,false)[0].children[0].data}catch(R){}try{S.link=C.getElementsByTagName("link",T.children,false)[0].children[0].data}catch(R){}try{S.description=C.getElementsByTagName("description",T.children,false)[0].children[0].data}catch(R){}try{S.pubDate=new Date(C.getElementsByTagName("pubDate",T.children,false)[0].children[0].data)}catch(R){}O.items.push(S)})}else{O.type="atom";try{O.id=C.getElementsByTagName("id",P.children,false)[0].children[0].data}catch(M){}try{O.title=C.getElementsByTagName("title",P.children,false)[0].children[0].data}catch(M){}try{O.link=C.getElementsByTagName("link",P.children,false)[0].attributes.href}catch(M){}try{O.description=C.getElementsByTagName("subtitle",P.children,false)[0].children[0].data}catch(M){}try{O.updated=new Date(C.getElementsByTagName("updated",P.children,false)[0].children[0].data)}catch(M){}try{O.author=C.getElementsByTagName("email",P.children,true)[0].children[0].data}catch(M){}O.items=[];C.getElementsByTagName("entry",P.children).forEach(function(T,Q,U){var S={};try{S.id=C.getElementsByTagName("id",T.children,false)[0].children[0].data}catch(R){}try{S.title=C.getElementsByTagName("title",T.children,false)[0].children[0].data}catch(R){}try{S.link=C.getElementsByTagName("link",T.children,false)[0].attributes.href}catch(R){}try{S.description=C.getElementsByTagName("summary",T.children,false)[0].children[0].data}catch(R){}try{S.pubDate=new Date(C.getElementsByTagName("updated",T.children,false)[0].children[0].data)}catch(R){}O.items.push(S)})}this.dom=O}s.super_.prototype.done.call(this)};var C={testElement:function D(M,O){if(!O){return false}for(var N in M){if(!M.hasOwnProperty(N)){continue}if(N=="tag_name"){if(O.type!==c.Tag){return false}if(!M.tag_name(O.name)){return false}}else{if(N=="tag_type"){if(!M.tag_type(O.type)){return false}}else{if(N=="tag_contains"){if(O.type!==c.Text&&O.type!==c.Comment&&O.type!==c.CData){return false}if(!M.tag_contains(O.data)){return false}}else{if(!O.attributes||!M[N](O.attributes[N])){return false}}}}}return true},getElements:function F(U,Q,M,N){M=(M===undefined||M===null)||!!M;N=isNaN(parseInt(N))?-1:parseInt(N);if(!Q){return([])}var T=[];var P;function R(V){return function(W){return(W==V)}}for(var S in U){if((typeof U[S])!="function"){U[S]=R(U[S])}}if(C.testElement(U,Q)){T.push(Q)}if(N>=0&&T.length>=N){return(T)}if(M&&Q.children){P=Q.children}else{if(Q instanceof Array){P=Q}else{return(T)}}for(var O=0;O<P.length;O++){T=T.concat(C.getElements(U,P[O],M,N));if(N>=0&&T.length>=N){break}}return(T)},getElementById:function K(P,N,O){var M=C.getElements({id:P},N,O,1);return(M.length?M[0]:null)},getElementsByTagName:function y(O,N,P,M){return(C.getElements({tag_name:O},N,P,M))},getElementsByTagType:function m(O,N,P,M){return(C.getElements({tag_type:O},N,P,M))}};J.Parser=e;J.HtmlBuilder=I;J.RssBuilder=s;J.ElementType=c;J.DomUtils=C})();